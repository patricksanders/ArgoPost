<!DOCTYPE html>
<html>
  <head>
    <title>Delete/Expire Test</title>
    		
    <!-- Import the JQuery/AJAX stuff -->
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js" ></script>
		
    <script type="text/javascript">
    
      // This function will integrate with the Search/Filter class
      function getPostID()
      {
        /*
        // Get the URL
        var url = document.URL

        // This is for testing purposes
        url = "www.argopost.com/forum/thread/postID=13523.htm"
        
        // Get each field in the URL
        var urlFields = url.split("/")
        // Get the last post 
        var post = urlFields[urlFields.length - 1]
        
        // Get the post ID
        var id = post.substring(7, post.length - 4)
        */
        
        // This is user defined for the time being
        var id = document.getElementById("thisPostID").value;
        return id;
      }
      
      function getDate()
      {
         // Get the current date and time
        var currentTime = new Date()
        
        // Calculate the month, day and year
        var month = currentTime.getMonth() + 1
        var day = currentTime.getDate()
        var year = currentTime.getFullYear()
        var date = month + "/" + day + "/" + year;
        
        return date
      }
 
      // Flag the expired posts in the database
      function markExpired()
      {
        // Get the date
        var date = getDate()
        markExpiredCF(date);
      }
      
      // Calls the ColdFusion function to mark expired posts
      function markExpiredCF(dDate){             
        $.ajax({
        // @Charlie Do you need to change the .cfc file and method name?
        type: "GET", url: "http://192.168.88.27:8500/argoPostDelete.cfc?wsdl&method=deleteSinglePost",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        data:{date:dDate},
        success: succeededed,
        failure: failedMiserably
        });           
      }
      
      // Delete all expired posts from the database
      function deleteExpired()
      {
        var date = getDate()
        deleteExpiredCF(date)
      }
      
      // Calls the ColdFusion function to delete expired posts
      function deleteExpiredCF(dDate){             
        $.ajax({
        // @Charlie Do you need to change the .cfc file and method name?
        type: "GET", url: "http://192.168.88.27:8500/argoPostDelete.cfc?wsdl&method=deleteSinglePost",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        data:{date:dDate},
        success: succeededed,
        failure: failedMiserably
        });           
      }
      
      // Delete a single post from the database
      function deleteSinglePost()
      {
        // Pass in the postID
        var postID = getPostID()
        deleteSinglePostCF(postID);
      }
      
      // Calls ColdFusion function to delete a single post
      function deleteSinglePostCF(pPostID){             
        $.ajax({
        type: "GET", url: "http://192.168.88.27:8500/argoPostDelete.cfc?wsdl&method=deleteSinglePost",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        data:{postID:pPostID},
        success: succeededed,
        failure: failedMiserably
        });           
      }

      // Displays success message
      function succeededed(response){
        alert("Success!")
        
        console.log("succeeded");
        $.each(response, function(key,value){  console.log(key + ": " + value)});
      }
                          
      // Displays failure message
      function failedMiserably(){
        alert("Failed!")
        
        console.log("failed");
      }
    
    </script>
  </head>

  <body>
    
    <!-- User defined post ID -->
    <input type="text" id="thisPostID">
		
    <!-- This is a button to test the JavaScript -->
    <button onclick="deleteExpired()">Delete Expired</button>
    <button onclick="deleteSinglePost()">Delete Single Post</button>
    <button onclick="markExpired()">Mark Expired</button>
    
  </body>
  
 
  
</html>